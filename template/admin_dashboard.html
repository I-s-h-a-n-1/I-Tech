<!DOCTYPE html>
<!--suppress ALL -->
<html lang="">
<head>
  <title>Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- ensures responsiveness -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{url_for('static', filename='css/admin.css')}}">
  <link rel="stylesheet" href="{{url_for('static', filename='css/styles.css')}}">
</head>
<body class="p-4">
 <div class="container_1"></div>
  <div class="container-fluid">
    <h2>Admin Dashboard</h2>
    <p class="title">Welcome,Ishan! Manage your users below:</p>


    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, msg in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ msg }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <div class="user-form">
      <h4>Add New User</h4>
      <form method="POST" action="{{ url_for('add_user') }}">
        <div class="row g-2 mb-2">
          <div class="col-12 col-md"><input class="form-control" placeholder="Username" name="username" required></div>
          <div class="col-12 col-md"><input class="form-control" placeholder="Email" name="email" type="email" required></div>
          <div class="col-12 col-md"><input class="form-control" placeholder="Password" name="password" type="password" required></div>
          <div class="col-12 col-md"><input class="form-control" placeholder="Amount Paid" name="amount_paid" type="number" step="0.01"></div>
        </div>
        <div class="row g-2 mb-2">
          <div class="col-12 col-md"><input class="form-control" placeholder="Year" name="year"></div>
          <div class="col-12 col-md"><input class="form-control" placeholder="Department" name="department"></div>
          <div class="col-12 col-md"><input class="form-control" placeholder="Balance" name="balance" type="number" step="0.01"></div>
          <div class="col-12 col-md"><input class="form-control" placeholder="Admin? 0 or 1" name="is_admin" required></div>
        </div>
        <button type="submit" class="btn btn-success">Add User</button>
      </form>
    </div>


    <div class="table-responsive">
       <h2>User Table</h2>
      <!-- makes table scrollable on small screens -->
      <table class="table table-bordered">

        <thead class="top">
          <tr>
            <th>ID</th><th>Username</th><th>Email</th><th>Department</th><th>Balance</th> <th>Amount Paid</th><th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for user in users %}
          <tr>
            <td>{{ user.id }}</td>
            <td>{{ user.username }}</td>
            <td>{{ user.email }}</td>
            <td>{{ user.department }}</td>
            <td>Le{{ "%.2f"|format(user.balance) }}</td>
            <td>{{ user.amount_paid }}</td>
            <td>
              <!-- Delete User -->
              <form method="POST" action="{{ url_for('delete_user', user_id=user.id) }}" class="d-inline">
                <button class="btn btn-danger btn-sm action-btn" onclick="return confirm('Delete {{ user.username }}?');">Delete</button>
              </form>

              <button class="btn btn-warning btn-sm action-btn"
                onclick="resetPassword({{ user.id }}, '{{ user.username }}')">Reset Password</button>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <br><br>
     <form method="POST" enctype="multipart/form-data" class="st-materials" action="{{url_for('upload_file')}}">
      {{ form.hidden_tag() }}
      <h2>Upload File</h2>
      <div class="mb-3">
        {{ form.file.label(class="form-label") }}
        {{ form.file(class="form-control") }}
        <br>
        {{form.studentYear.label(class="form-label")}}
        {{ form.studentYear(class="form-control st-yr")}}
      </div>
      {{ form.submit(class="btn btn-primary") }}
    </form>

      <br><br>

       <table class="table table-bordered">
         <h2>File Table</h2>
        <thead class="top">
          <tr>
            <th>ID</th><th>File Name</th><th>File Type</th><th>Year</th><th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for file in files %}
          <tr>
            <td>{{ file.id }}</td>
            <td>{{ file.filename }}</td>
            <td>{{ file.filetype }}</td>
            <td>{{ file.year }}</td>
            <td>
              <!-- Delete User -->
              <form method="POST" action="{{ url_for('delete_file', file_id=file.id) }}">

              <button type="submit" class="btn btn-danger btn-sm" onclick=" confirm('Delete {{ file.filename }}?');">Delete</button>
             </form>

            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <br><br>
    <form action="{{url_for('announcement')}}" class="announcement-form" method="Post">
      <h2>Upload Announcement</h2>
      <br>
      <label for="title">Message Title:</label><br>
      <input type="text" name="mg-title" class="mg-title form-control" id="title" required><br>
      <h6>Message body</h6>
      <textarea class="message_content form-control" name="announcement" required>

    </textarea><br>
      <input type="submit" class="btn btn-primary" value="Upload Announcement">

    </form>
    <br><br>
     <table class="table table-bordered">
         <h2>Announcement Table</h2>
        <thead class="top">
          <tr>
            <th>ID</th><th>Title</th><th>Message</th><th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for message in messages %}
          <tr>
            <td>{{ message.id }}</td>
            <td>{{ message.header}}</td>
            <td>{{ message.content }}</td>
            <td>
              <!-- Delete User -->
              <form method="POST" action="{{url_for('delete_message', message_id = message.id) }}">

              <button type="submit" class="btn btn-danger btn-sm"  onclick="return confirm('Delete {{ message.header }}?');">Delete</button>
             </form>

            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    <br><br>

    
    <a href="/logout" class="btn btn-secondary mt-3">Logout</a>
  </div>


  <script src="{{ url_for('static', filename='js/admin.js') }}"></script>
  <script src="{{ url_for('static', filename='js/home_bubbles.js') }}"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
